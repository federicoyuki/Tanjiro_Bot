import os from 'os';
import { execSync } from 'child_process';

const formatBytes = (bytes, decimals = 2) => {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const dm = decimals < 0 ? 0 : decimals;
    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
};

const getDiskSpace = () => {
    try {
        const stdout = execSync('df -h | grep -E "^/dev/root|^/dev/sda1"').toString();
        const [ , size, used, available, usePercent ] = stdout.split(/\s+/);
        return { size, used, available, usePercent };
    } catch (error) {
        console.error('âœ§ Error al obtener el espacio en disco:', error);
        return null;
    }
};

const handler = async (m, { conn }) => {
    const totalMem = os.totalmem();
    const freeMem = os.freemem();
    const usedMem = totalMem - freeMem;
    const _muptime = process.uptime() * 1000
    const muptime = clockString(_muptime)
    const hostname = os.hostname();
    const platform = os.platform();
    const arch = os.arch();
    const nodeUsage = process.memoryUsage();
    const diskSpace = getDiskSpace();

    const message = `
ð“„¼.....ï¸µ Íœ Û¬ï¸µá·¼à£ªâœá·¼ÝŠ ð”•ªð–¤µð”•ªá·¼ÝŠâœá·¼à£ªï¸µÛ¬ Íœ ï¸µ.....ð“„¹
ð“†©ê¯­áš€áš€ê¯­áš€ð“²ÖŸáê¯­à©­ ê¯­âŒ‘(ê¯­ð‘º).ð‘°ê¯­.ð‘º.ê¯­ð‘».ê¯­ð‘¬.ê¯­ð‘´.ê¯­ð‘¨âŒ‘ê¯­ ð“²ÖŸáê¯­à©­áš€ê¯­áš€áš€ê¯­ð“†ª
â¬«   Íœ Û¬ï¸µá·¼à£ªï¸µï¸¨âœá·¼ÝŠâœ¿Û«âƒ˜ð‡½ê¥ˆð‡ˆÙœÙœÛªÙœÛªÙœÛªÙœÛªÙœÛªÙœÛªÙœÛªÙœÛªÙœÛªÙœÛªÙœÛªÙœÛªÙœÛªÙœÛªÙœÙœÛªÙœÛªÙœð‘Ùœð‡½ÛªÛªÙœÛªÙœÛªÙœÛªÙœÛªÙœÛªÙœÛªÙœÛªÙœÛªÙœÛªÙœÛªÙœÛªÙœÛªÙœÛªÙœð‡ˆâƒ˜Û«ê¥ˆâœ¿ÝŠá·¼âœï¸§ï¸µà£ªá·¼ï¸µÛ¬ Íœ   â¬«*
â•­â”â‹†â‹….â‹…â‹†â”â‹†â‹….â‹…â‹†â”â‹†â‹….â‹…â‹†â”â‹†â‹….â‹…â‹†â”â‹†â‹….â‹…â‹†â”â”„â•®
â”‚ï¢” â¬ªà£ªâ¤ÍŸÍžà¥‚âƒª áÍœâž \`${done} ð‘¬ð’”ð’•ð’‚ð’…ð’ ð‘«ð’†ð’ ð‘ºð’Šð’”ð’•ð’†ð’Žð’‚\` á—âƒ˜âƒ”âƒ®á—à»‘âƒªÝŠÝŠÝŠÝŠà£­ÛªÙœð‘ê¥ˆà£ªâ¬ª â”‚
â•°â”â‹†â‹….â‹…â‹†â”â‹†â‹….â‹…â‹†â”â‹†â‹….â‹…â‹†â”â‹†â‹….â‹…â‹†â”â‹†â‹….â‹…â‹†â”â”„â•¯
â•­Û«à£­à£­à£­à£­à£­à£­Ùœâ”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ˜ªï¸Žï¸Žï¸ŽÌ¸âƒ˜à£ªà£ªà£ªÛ¬Ì¸à£­Ùœâ—Œâƒ˜ÖŸáÖ¯ÛªÛ«Û«ï¸ŽÛ«Û¬ð‡½âƒªâ—Œâƒ˜à£ªà£ªà£ªÛ¬à£­Ùœâ˜ªï¸Žï¸Žï¸Žï¸ŽÌ¸â”„Û«à£­à£­à£­â”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ”„Û«à£­à£­à£­ÖŸáâ”„Û«Ì¸à£­â”„Û«Ì¸à£­à£­à£­à£­â”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ”„Û«Ì¸à£­â”„Û«à£­à£­à£­ÖŸáâ”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ”„Û«Ì¸à£­â”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ”„Û«à£­à£­à£­â•®
â•‘ðŸœï¸ *Host âž¤* ${hostname}
â•‘ðŸ† *Plataforma âž¤* ${platform}
â•‘âš¡ *Arquitectura âž¤* ${arch}
â•‘ðŸ­ *RAM Total âž¤* ${formatBytes(totalMem)}
â•‘ðŸ“š *RAM Libre âž¤* ${formatBytes(freeMem)}
â•‘ðŸ« *RAM Usada âž¤* ${formatBytes(usedMem)}
â•‘ðŸ”¥ *Tiempo Activo âž¤* ${muptime}
â•°â”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ”„Û«à£­à£­à£­â”„Û«Ì¸à£­â”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ”„Û«Ì¸à£­à£­à£­à£­à£­ÙœÖŸáâ”„Û«à£­à£­à£­â”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ”„Û«à£­à£­à£­â”„Û«Ì¸à£­ÖŸáâ”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ”„Û«Ì¸à£­â”„Û«à£­à£­à£­â˜ªï¸Žï¸Žï¸ŽÌ¸âƒ˜à£ªà£ªà£ªÛ¬Ì¸à£­Ùœâ—Œâƒ˜ÖŸáÖ¯ÛªÛ«Û«ï¸ŽÛ«Û¬ð‡½âƒªâ—Œâƒ˜à£ªà£ªà£ªÛ¬à£­Ùœâ˜ªï¸Žï¸Žï¸Žï¸ŽÌ¸â”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ•¯

â•­Û«à£­à£­à£­à£­à£­à£­Ùœâ”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ˜ªï¸Žï¸Žï¸ŽÌ¸âƒ˜à£ªà£ªà£ªÛ¬Ì¸à£­Ùœâ—Œâƒ˜ÖŸáÖ¯ÛªÛ«Û«ï¸ŽÛ«Û¬ð‡½âƒªâ—Œâƒ˜à£ªà£ªà£ªÛ¬à£­Ùœâ˜ªï¸Žï¸Žï¸Žï¸ŽÌ¸â”„Û«à£­à£­à£­â”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ”„Û«à£­à£­à£­ÖŸáâ”„Û«Ì¸à£­â”„Û«Ì¸à£­à£­à£­à£­â”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ”„Û«Ì¸à£­â”„Û«à£­à£­à£­ÖŸáâ”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ”„Û«Ì¸à£­â”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ”„Û«à£­à£­à£­â•®
â•‘ ðŸ’» *Uso de Memoria Nodejs:* 
â•‘ðŸ‘‘â†’ RSS: ${formatBytes(nodeUsage.rss)}
â•‘âš”ï¸â†’ Heap Total: ${formatBytes(nodeUsage.heapTotal)}
â•‘ðŸ‰â†’ Heap Usado: ${formatBytes(nodeUsage.heapUsed)}
â•‘ðŸ­â†’ Externa: ${formatBytes(nodeUsage.external)}
â•‘â­â†’ Arreglos: ${formatBytes(nodeUsage.arrayBuffers)}
${diskSpace ? `
â•°â”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ”„Û«à£­à£­à£­â”„Û«Ì¸à£­â”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ”„Û«Ì¸à£­à£­à£­à£­à£­ÙœÖŸáâ”„Û«à£­à£­à£­â”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ”„Û«à£­à£­à£­â”„Û«Ì¸à£­ÖŸáâ”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ”„Û«Ì¸à£­â”„Û«à£­à£­à£­â˜ªï¸Žï¸Žï¸ŽÌ¸âƒ˜à£ªà£ªà£ªÛ¬Ì¸à£­Ùœâ—Œâƒ˜ÖŸáÖ¯ÛªÛ«Û«ï¸ŽÛ«Û¬ð‡½âƒªâ—Œâƒ˜à£ªà£ªà£ªÛ¬à£­Ùœâ˜ªï¸Žï¸Žï¸Žï¸ŽÌ¸â”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ•¯

â•­Û«à£­à£­à£­à£­à£­à£­Ùœâ”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ˜ªï¸Žï¸Žï¸ŽÌ¸âƒ˜à£ªà£ªà£ªÛ¬Ì¸à£­Ùœâ—Œâƒ˜ÖŸáÖ¯ÛªÛ«Û«ï¸ŽÛ«Û¬ð‡½âƒªâ—Œâƒ˜à£ªà£ªà£ªÛ¬à£­Ùœâ˜ªï¸Žï¸Žï¸Žï¸ŽÌ¸â”„Û«à£­à£­à£­â”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ”„Û«à£­à£­à£­ÖŸáâ”„Û«Ì¸à£­â”„Û«Ì¸à£­à£­à£­à£­â”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ”„Û«Ì¸à£­â”„Û«à£­à£­à£­ÖŸáâ”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ”„Û«Ì¸à£­â”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ”„Û«à£­à£­à£­â•®
â•‘   â˜ï¸ *Espacio en Disco:*
â•‘ðŸ’¦â†’ TamaÃ±o Total: ${diskSpace.size}
â•‘ðŸ“šâ†’ Usado: ${diskSpace.used}
â•‘ðŸŒ¸â†’ Disponible: ${diskSpace.available}
â•‘â˜ƒï¸â†’ Porcentaje de Uso: ${diskSpace.usePercent}` : 'Error.'}
â•°â”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ”„Û«à£­à£­à£­â”„Û«Ì¸à£­â”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ”„Û«Ì¸à£­à£­à£­à£­à£­ÙœÖŸáâ”„Û«à£­à£­à£­â”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ”„Û«à£­à£­à£­â”„Û«Ì¸à£­ÖŸáâ”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ”„Û«Ì¸à£­â”„Û«à£­à£­à£­â˜ªï¸Žï¸Žï¸ŽÌ¸âƒ˜à£ªà£ªà£ªÛ¬Ì¸à£­Ùœâ—Œâƒ˜ÖŸáÖ¯ÛªÛ«Û«ï¸ŽÛ«Û¬ð‡½âƒªâ—Œâƒ˜à£ªà£ªà£ªÛ¬à£­Ùœâ˜ªï¸Žï¸Žï¸Žï¸ŽÌ¸â”„Û«Ì¸à£­à£­à£­à£­à£­Ùœâ•¯`;

    await conn.reply(m.chat, message.trim(), m, rcanal, );
};

handler.help = ['sistema'];
handler.tags = ['info'];
handler.command = ['system', 'sistema'];
handler.register = true;

export default handler;

function clockString(ms) {
let h = isNaN(ms) ? '--' : Math.floor(ms / 3600000)
let m = isNaN(ms) ? '--' : Math.floor(ms / 60000) % 60
let s = isNaN(ms) ? '--' : Math.floor(ms / 1000) % 60
return [h, m, s].map(v => v.toString().padStart(2, 0)).join(':')}